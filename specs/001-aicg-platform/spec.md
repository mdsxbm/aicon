# Feature Specification: AICG内容分发平台

**Feature Branch**: `001-aicg-platform`
**Created**: 2025-11-06
**Status**: Draft
**Input**: User description: "我的相关需求在./docs目录中，请阅读它，分析我的需求，用中文生成spec.md文档。"

## Clarifications

### Session 2025-11-06

- Q: 用户角色和权限边界如何定义？ → A: 单一用户模式：专注于个人创作者，所有功能对单个用户开放，算力由用户自己上传的API key提供，系统只负责调用API
- Q: 文档格式支持和章节识别规则？ → A: 支持多种格式（TXT、MD、DOCX、EPUB），智能识别章节标题，尽可能支持更多文体的识别不限于（小说，散文，诗歌）
- Q: 发布失败时的重试策略？ → A: 用户控制重试，显示失败原因（如无额度或其他），提供立即重试按钮和定时重试选项
- Q: 数据存储和隐私保护策略？ → A: 分层存储策略：原始资源30天，成品视频永久，提供数据管理面板和导出功能
- Q: API密钥验证和配额管理机制？ → A: 延迟验证：在生成开始前统一验证所有密钥，失败时阻止生成

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 超长文本处理与章节管理 (Priority: P1)

小说作者上传百万字小说，系统能够自动进行章节切割，作者可以选择特定章节进行内容编辑和确认，然后将确认后的章节加入视频生成队列。

**Why this priority**: 这是平台的核心价值主张，解决了内容创作者面临的最大痛点——超长文本的视频化处理问题。

**Independent Test**: 可以通过上传一个包含多个章节的长文本文档，验证系统能否正确识别章节结构、提供编辑界面、并支持章节选择和确认操作。

**Acceptance Scenarios**:

1. **Given** 用户上传了一个100万字的小说文档，**When** 系统处理完成后，**Then** 用户可以看到按章节组织的结构列表，每个章节显示字数和状态
2. **Given** 用户在章节列表中选择了第3章和第5章，**When** 用户点击"解析详情"，**Then** 系统只解析这两个章节的段落和句子结构，不解析其他章节
3. **Given** 用户正在编辑第3章内容，**When** 用户删除了某个段落并标记另一个段落为忽略，**When** 用户保存操作，**Then** 系统自动保存更改并更新章节状态为"已确认"

---

### User Story 2 - 视频生成与进度管理 (Priority: P1)

用户选择已确认的章节进行批量视频生成，系统能够异步处理生成任务，提供实时进度跟踪，并支持任务的暂停、继续和取消操作。

**Why this priority**: 视频生成是平台的核心功能，用户体验直接取决于生成过程的可控性和进度可见性。

**Independent Test**: 可以通过选择多个章节启动生成任务，验证系统能否正确管理任务队列、显示进度状态，并支持中断恢复操作。

**Acceptance Scenarios**:

1. **Given** 用户选择了3个已确认的章节，**When** 用户点击"批量生成"，**Then** 系统将这3个章节加入生成队列并显示预估完成时间
2. **Given** 正在生成第2章的过程中，**When** 用户点击"暂停"，**Then** 系统停止当前生成任务并保存进度，用户稍后可以继续
3. **Given** 生成过程中某个图片生成失败，**When** 系统检测到失败，**Then** 系统自动重试该图片生成3次，如仍失败则标记该部分为失败状态，允许用户单独重新生成

---

### User Story 3 - 内容分发与发布管理 (Priority: P1)

用户生成完章节视频后，能够通过绑定的平台账号将视频发布到B站和YouTube，支持单视频发布、批量发布和定时发布功能。

**Why this priority**: 内容分发是产品价值链的最后一环，直接影响用户的内容传播效果和商业价值实现。

**Independent Test**: 可以通过绑定测试账号，验证视频能否成功发布到目标平台，并检查发布记录的准确性。

**Acceptance Scenarios**:

1. **Given** 用户已绑定B站和YouTube账号，**When** 用户选择5个完成的章节视频，**When** 用户点击"批量发布"，**Then** 系统依次将5个视频发布到对应平台并显示发布状态
2. **Given** 用户设置了定时发布，**When** 用户指定明天上午10点发布第1章，**Then** 系统在指定时间自动执行发布任务
3. **Given** 某个视频发布失败，**When** 系统检测到失败，**Then** 系统记录失败原因并允许用户重新尝试发布

---

### User Story 4 - AI服务配置与用量管理 (Priority: P2)

用户在设置中管理多个AI服务供应商的API密钥，选择不同的服务进行视频生成，并查看各服务的用量统计和费用消耗。

**Why this priority**: AI服务是核心生产资源，用户需要灵活配置和监控使用情况以控制成本。

**Independent Test**: 可以通过添加多个API密钥，验证系统能否正确管理密钥、显示用量统计，并支持密钥的启用/禁用操作。

**Acceptance Scenarios**:

1. **Given** 用户添加了火山引擎和其他供应商的API密钥，**When** 用户在生成任务前选择密钥，**Then** 系统使用选定的密钥进行AI服务调用
2. **Given** 用户本月已生成了50个章节视频，**When** 用户查看用量统计，**Then** 系统显示各供应商的调用次数、生成内容数量和预估费用
3. **Given** 某个API密钥达到限额，**When** 系统检测到限额，**Then** 系统自动切换到备用密钥并通知用户

---

### Edge Cases

- 当上传的文档格式不规范或缺少章节标记时，系统如何处理？
- 当生成过程中的某个AI服务不可用时，系统如何保证任务继续？
- 当用户同时上传多个大文件时，系统如何处理资源竞争？
- 当网络中断时，未完成的编辑操作如何恢复？
- 当发布平台API变更时，系统如何适配？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: System MUST 支持百万字级文本文件上传，提供上传进度条和断点续传功能
- **FR-002**: System MUST 自动识别文档中的章节结构并生成章节列表，支持章、节、回等标记
- **FR-003**: System MUST 支持按需进行章节内容的详细解析（段落和句子级别），避免一次性解析整个文档
- **FR-004**: System MUST 提供章节级编辑器，支持文本编辑、段落合并/拆分、忽略标记功能
- **FR-005**: System MUST 实现两级确认机制：章节结构确认和章节内容确认
- **FR-006**: System MUST 支持异步视频生成流程：句子图片生成→段落音频生成→时间轴识别→视频合成
- **FR-007**: System MUST 提供生成队列管理，显示任务状态、进度和预计完成时间
- **FR-008**: System MUST 支持生成任务的暂停、继续、取消和断点续传
- **FR-009**: System MUST 支持多平台内容分发（B站、YouTube），包括单视频和批量发布
- **FR-010**: System MUST 提供API密钥管理功能，支持多供应商、多密钥配置和切换
- **FR-011**: System MUST 显示实时用量统计和费用预估，支持配额管理和超限预警
- **FR-012**: System MUST 确保用户数据安全，包括API密钥加密存储和文件传输加密

### Performance Constraints

- **环境依赖**: 章节切割性能指标基于标准开发环境（8核CPU、16GB内存、SSD存储）
- **AI服务依赖**: 图像生成时间（30-60秒/张）取决于第三方API响应时间，超出系统控制范围
- **网络影响**: 所有性能指标假设网络连接稳定，上传速度不低于10Mbps
- **文档复杂度**: 性能指标基于标准小说格式文档，复杂格式文档可能需要更长时间
- **并发限制**: 100+并发生成任务需要相应的硬件资源配置支持

### Key Entities

- **用户 (User)**: 代表内容创作者，包含基本信息、认证凭据、偏好设置
- **项目 (Project)**: 关联一个源文本文件，包含项目配置、处理状态、生成历史
- **章节 (Chapter)**: 文档的逻辑分割单元，包含标题、内容、解析状态、确认状态
- **段落 (Paragraph)**: 章节内的文本段落，关联生成的音频和时间轴信息
- **句子 (Sentence)**: 段落内的句子单元，关联生成的图片和音频时间点
- **生成任务 (Generation Task)**: 视频生成的工作单元，包含状态、进度、资源引用
- **发布记录 (Publication Record)**: 视频发布的操作记录，包含平台、状态、链接
- **API配置 (API Configuration)**: AI服务的配置信息，包含密钥、供应商、用量统计

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户能够上传并处理100万字以上的文本文档，章节识别准确率达到95%以上
- **SC-002**: 百万字文档的初步章节切割在30秒内完成，章节解析在20秒内完成（基于标准开发环境配置）
- **SC-003**: 系统能够支持至少100个并发生成任务，99.9%的任务能够成功完成
- **SC-004**: 用户完成从上传到首个章节视频生成的端到端流程时间不超过10分钟
- **SC-005**: 系统年可用性不低于99.9%，核心功能故障恢复时间不超过5分钟
- **SC-006**: 90%的用户能够在首次使用时独立完成章节编辑和确认操作
- **SC-007**: 视频发布成功率不低于98%，发布失败时90%的情况下能够通过重试解决
- **SC-008**: 系统处理的单个视频文件大小不超过2GB，支持批量下载和分批发布
